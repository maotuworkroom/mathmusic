(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{3954:function(e,t,a){e.exports=a(4161)},3959:function(e,t,a){},3961:function(e,t,a){},3969:function(e,t){},4161:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(16),i=a.n(o),l=(a(3959),a(164)),s=a.n(l),c=a(255),u=a(26),m=a(27),p=a(29),g=a(28),h=a(24),d=a(30),v=(a(3961),a(4203)),f=a(4204),b=a(4163),E=a(21),x=a(87),C=a(48),O=a(37),w=a(4205);var j=a(258),y=a.n(j),S=a(126),k=function(e,t){if(null!==e){var a=[];return e.forEach(function(n,r){for(var o=n.length.error?0:n.length.value,i=0,l=0;l<r;l++){var s=e[l].length.error?0:e[l].length.value;i+=s}var c=Object(S.range)(0,o/1e3,.001),u=(n.expression.error?Object(w.b)("0"):Object(w.b)(n.expression.value)).compile(),m=Object(S.map)(c,function(e){return u.evaluate({x:t*e})}),p=Object(S.map)(c,function(e){return e+i/1e3});a.push({mode:"lines",x:p,y:m})}),a}},N=a(3965),T=y()(N),D=function(e){function t(){return Object(u.a)(this,t),Object(p.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return r.a.createElement(T,{className:"Graph",useResizeHandler:!0,revision:this.props.getRevision,config:{displayModeBar:!1},data:k(this.props.data,this.props.multiplier),layout:{showlegend:!1,autosize:!0,xaxis:{title:"Time (s)"},yaxis:{title:"Frequency (Hz)<br />&nbsp;",range:[0,this.props.upperRange]},margin:{t:40,l:85,r:50,b:80,pad:5}}})}}]),t}(n.Component),M=a(6),R=a(4209),A=a(4195),I=a(4196),z=a(88),L=a(4190),P={button:{backgroundColor:"#f5f5f5",fontWeight:500}},J=function(e){function t(){return Object(u.a)(this,t),Object(p.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"EditorOptions"},r.a.createElement(L.a,{variant:"contained",size:"medium",style:P.button,onClick:this.props.onAddTrack},"Track\xa0",r.a.createElement(E.h,null)),r.a.createElement("div",{style:{flexGrow:1}}),r.a.createElement(L.a,{variant:"contained",size:"medium",style:Object.assign({marginRight:10},P.button),onClick:function(){return e.props.toggleModal("load")}},"Load\xa0",r.a.createElement(E.l,null)),r.a.createElement(L.a,{variant:"contained",size:"medium",style:P.button,onClick:function(){return e.props.toggleModal("save")}},"Save\xa0",r.a.createElement(E.b,null)))}}]),t}(n.Component),G=a(4206),B=a(260),F=function(e){function t(){return Object(u.a)(this,t),Object(p.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"EditorOutput"},r.a.createElement("span",{style:{marginRight:25}},"Output:"),this.props.error?r.a.createElement("span",{className:"EditorOutputError"},this.props.output):r.a.createElement(B.Tex,{texContent:(e=this.props.output,"\\Large f(x)=".concat(Object(w.b)(Object(w.a)(e)).toTex()))}));var e}}]),t}(n.Component),q={title:{width:100},equation:{width:"25%"},length:{width:100},volume:{width:90}},H=function(e){function t(){return Object(u.a)(this,t),Object(p.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.selectedSegment,n=t.timelines,o=a.col,i=a.row;return r.a.createElement("div",{className:"EditorPanel"},r.a.createElement(G.a,{id:"standard-name",label:"Title",value:this.props.title.value,error:!!this.props.title.error,helperText:this.props.title.error,onChange:function(t){return e.props.onTrackDataChange(n,o,i,"title",t.target.value)},margin:"normal",style:q.title}),r.a.createElement(G.a,{label:"Equation f(x)",value:this.props.expression.value,error:!!this.props.expression.error,helperText:this.props.expression.error?"See output":"",onChange:function(t){return e.props.onTrackDataChange(n,o,i,"expression",t.target.value)},margin:"normal",style:q.equation}),r.a.createElement(G.a,{label:"Length (ms)",value:this.props.length.value,error:!!this.props.length.error,helperText:this.props.length.error,onChange:function(t){return e.props.onTrackDataChange(n,o,i,"length",t.target.value)},margin:"normal",style:q.length}),r.a.createElement(G.a,{label:"Volume (%)",value:this.props.volume.value,error:!!this.props.volume.error,helperText:this.props.volume.error,onChange:function(t){return e.props.onTrackDataChange(n,o,i,"volume",t.target.value)},margin:"normal",style:q.volume}),r.a.createElement(F,{output:this.props.expression.error?this.props.expression.error:this.props.expression.value,error:!!this.props.expression.error}),r.a.createElement(b.a,{onClick:function(){return e.props.onDeleteSegment()}},r.a.createElement(E.d,null)))}}]),t}(n.Component),W=a(129),U=function(e,t,a){var n=Array.from(e),r=n.splice(t,1),o=Object(O.a)(r,1)[0];return n.splice(a,0,o),n},V=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(p.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).onDragEnd=function(e){if(e.destination){var t=U(a.props.segments,e.source.index,e.destination.index);a.props.onSegmentRearrange(a.props.rowIndex,e.source.index,e.destination.index,t)}},a}return Object(d.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(W.a,{onDragEnd:this.onDragEnd},r.a.createElement(W.c,{droppableId:"droppable",direction:"horizontal"},function(t,a){return r.a.createElement("div",Object.assign({ref:t.innerRef,style:(n=a.isDraggingOver,{background:n?"#af4448":"#ffa4a2",display:"flex",justifyContent:"flex-start",padding:8,overflow:"auto",flexGrow:1,width:"100%"})},t.droppableProps),e.props.segments.map(function(t,a){return r.a.createElement(W.b,{key:t.id,draggableId:t.id,index:a},function(n,o){return r.a.createElement("div",Object.assign({ref:n.innerRef},n.draggableProps,n.dragHandleProps,{style:(o.isDragging,i=n.draggableProps.style,l=e.props.selectedSegment.row===e.props.rowIndex&&e.props.selectedSegment.col===a,Object(C.a)({userSelect:"none",marginLeft:5,padding:5,minHeight:16,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",alignSelf:"center",background:"#ffa4a2",borderBottom:l?"2px solid #EE6E73":"2px solid #ffa4a2"},i)),onClick:function(){return e.props.onSegmentSelection(e.props.rowIndex,a)}}),t.title.value);var i,l})}),t.placeholder,r.a.createElement("div",{className:"verticalDivider"}),r.a.createElement(b.a,{onClick:function(){return e.props.onAddSegment(e.props.rowIndex)},size:"small"},r.a.createElement(E.h,null)));var n}))}}]),t}(n.Component),_=a(4208),$=a(4212),Z=a(4194),K=function(e){function t(){return Object(u.a)(this,t),Object(p.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"TrackControl"},0!==this.props.rowIndex?r.a.createElement(L.a,{variant:"contained",size:"medium",onClick:function(){return e.props.onDeleteTrack(e.props.rowIndex)},style:{marginRight:10,backgroundColor:"#f5f5f5",fontWeight:500}},"Track\xa0 ",r.a.createElement(E.f,null)):r.a.createElement("div",{style:{width:120}}),r.a.createElement(_.a,{value:this.props.options.title,className:"trackTitle",inputProps:{style:{fontSize:16,padding:"6px 3px 5px",backgroundColor:"#f5f5f5"}},onChange:function(t){return e.props.onTrackOptionChange(e.props.rowIndex,"title",t.target.value)}}),r.a.createElement($.a,{size:"small",exclusive:!0,value:this.props.options.wave,onChange:function(t,a){return e.props.onTrackOptionChange(e.props.rowIndex,"wave",a)}},r.a.createElement(Z.a,{size:"small",value:"sine"},r.a.createElement(E.c,null)),r.a.createElement(Z.a,{size:"small",value:"triangle"},r.a.createElement(E.j,null)),r.a.createElement(Z.a,{size:"small",value:"saw"},r.a.createElement(E.e,null))),r.a.createElement($.a,{size:"small",style:{marginLeft:10}},r.a.createElement(Z.a,{size:"small",selected:this.props.options.mute,value:"mute",onClick:function(){return e.props.onTrackOptionChange(e.props.rowIndex,"mute","")}},r.a.createElement(E.m,null))))}}]),t}(n.Component),Q=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(p.a)(this,Object(g.a)(t).call(this,e))).animate=function(){a.timer=setInterval(a.props.animateGraph,16)},a.timer=null,a}return Object(d.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.selectedSegment,o=t.timelines,i=[],l=o[n.row].segments[n.col];return this.props.timelines.forEach(function(t,a){i.push(r.a.createElement("div",{key:a,className:"EditorTimelineRow"},r.a.createElement(K,{options:t.options,rowIndex:a,onTrackOptionChange:e.props.onTrackOptionChange,onDeleteTrack:e.props.onDeleteTrack}),r.a.createElement(V,{segments:t.segments,rowIndex:a,selectedSegment:n,onSegmentSelection:e.props.onSegmentSelection,onSegmentRearrange:e.props.onSegmentRearrange,onAddSegment:e.props.onAddSegment})))}),r.a.createElement(R.a,{defaultExpanded:!0,classes:{root:a.root,expanded:a.expanded},TransitionProps:{onEnter:this.animate,onEntered:function(){return clearInterval(e.timer)},onExit:this.animate,onExited:function(){return clearInterval(e.timer)}}},r.a.createElement(A.a,{expandIcon:r.a.createElement(E.a,null)},r.a.createElement(z.a,{className:a.heading},"Timeline Editor")),r.a.createElement(I.a,{classes:{root:a.details}},r.a.createElement("div",{className:"Editor"},r.a.createElement(J,{onAddTrack:this.props.onAddTrack,toggleModal:this.props.toggleModal}),r.a.createElement("div",{className:"EditorTimelineContainer"},i),l?r.a.createElement(H,{title:l.title,expression:l.expression,length:l.length,volume:l.volume,onTrackDataChange:this.props.onTrackDataChange,onDeleteSegment:this.props.onDeleteSegment,timelines:o,selectedSegment:n}):r.a.createElement("div",{className:"EmptyEditorPanel"}))))}}]),t}(n.Component),X=Object(M.a)(function(e){return{root:{width:"100%",backgroundColor:"#ffa4a2",flex:0,"&$expanded":{margin:0}},heading:{fontSize:e.typography.pxToRem(20),fontWeight:600},details:{wdith:"100%",backgroundColor:"black",padding:0},expanded:{margin:0}}})(Q),Y=a(4207);function ee(e){var t=r.a.useState(de),a=Object(O.a)(t,1)[0],n=ve();return r.a.createElement(Y.a,{open:e.open},r.a.createElement("div",{style:a,className:n.paper},r.a.createElement(z.a,{variant:"h5"},"Save Composition"),r.a.createElement("br",null),r.a.createElement(z.a,{variant:"subtitle1"},"Copy the text below"),r.a.createElement(G.a,{label:"Output",multiline:!0,className:n.textField,rows:"7",value:e.currentComposition,margin:"normal",variant:"filled"}),r.a.createElement("br",null),r.a.createElement(z.a,{variant:"subtitle1"},"or"),r.a.createElement(L.a,{variant:"contained",download:"composition.json",target:"_blank",href:"data:text/json;charset=utf-8,".concat(encodeURIComponent(e.currentComposition)),style:{maxWidth:200,alignSelf:"center"}},"Save Json"),r.a.createElement("br",null),r.a.createElement("div",{className:"modalActions"},r.a.createElement(L.a,{variant:"contained",onClick:function(){return e.toggleModal("save")}},"Close"))))}var te=a(269);function ae(e){var t=Object(n.useState)(de),a=Object(O.a)(t,1)[0],o=Object(n.useState)(""),i=Object(O.a)(o,2),l=i[0],s=i[1],c=ve(),u=Object(n.useCallback)(function(e){var t=new FileReader;t.onabort=function(){return alert("File reading aborted")},t.onerror=function(){return alert("File reading has failed")},t.onload=function(){s(t.result)},e.forEach(function(e){return t.readAsText(e)})},[]),m=Object(te.a)({onDrop:u,accept:".json",multiple:!1}),p=m.getRootProps,g=m.getInputProps;return r.a.createElement(Y.a,{open:e.open},r.a.createElement("div",{style:a,className:c.paper},r.a.createElement(z.a,{variant:"h5"},"Load Composition"),r.a.createElement("br",null),r.a.createElement(z.a,{variant:"subtitle1"},"Paste json below"),r.a.createElement(G.a,{label:"Input",multiline:!0,className:c.textField,rows:"7",value:l,margin:"normal",variant:"filled",onChange:function(e){return s(e.target.value)}}),r.a.createElement("br",null),r.a.createElement(z.a,{variant:"subtitle1"},"or"),r.a.createElement("br",null),r.a.createElement("div",Object.assign({},p(),{className:"LoadModalFileZone"}),r.a.createElement("input",g()),r.a.createElement("p",null,"Drag 'n' drop a file here, or click to select file")),r.a.createElement("br",null),r.a.createElement("div",{className:"modalActions"},r.a.createElement(L.a,{variant:"contained",style:{marginRight:10},onClick:function(){return e.toggleModal("load")}},"Cancel"),r.a.createElement(L.a,{variant:"contained",onClick:function(){return e.onLoadJson(l)}},"Load"))))}var ne=a(4197),re=a(4210),oe=a(4198),ie={volume:{width:139},multiplier:{width:250},graphRange:{width:173},fs:{width:180}};function le(e){var t=r.a.useState(de),a=Object(O.a)(t,1)[0],n=ve(),o=e.settings,i=o.fs,l=o.volume,s=o.multiplier,c=o.graphRange,u=o.aliasing;return r.a.createElement(Y.a,{open:e.open},r.a.createElement("div",{style:a,className:n.paper},r.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},r.a.createElement("div",{className:"settingsColumn"},r.a.createElement(z.a,{variant:"h5"},"Settings"),r.a.createElement(G.a,{label:"Master volume (%)",value:l.value,error:!!l.error,helperText:l.error,onChange:function(t){return e.onChange("volume",t.target.value)},margin:"normal",style:ie.volume}),r.a.createElement(G.a,{label:"Auto multipler for function input (x)",value:s.value,error:!!s.error,helperText:s.error,onChange:function(t){return e.onChange("multiplier",t.target.value)},margin:"normal",style:ie.multiplier}),r.a.createElement(G.a,{label:"Upper graph range (Hz)",value:c.value,error:!!c.error,helperText:c.error,onChange:function(t){return e.onChange("graphRange",t.target.value)},margin:"normal",style:ie.graphRange}),r.a.createElement(G.a,{label:"Sampling frequency (Hz)",value:i.value,error:!!i.error,helperText:i.error,onChange:function(t){return e.onChange("fs",t.target.value)},margin:"normal",style:ie.fs}),r.a.createElement(ne.a,{style:{alignSelf:"flex-start",marginLeft:0,marginTop:15},control:r.a.createElement(re.a,{checked:u,onChange:function(){return e.onChange("aliasing")}}),label:"Enable Aliasing",labelPlacement:"start"})),r.a.createElement("div",{className:"aboutBorder"},r.a.createElement(z.a,{variant:"h6",style:{alignSelf:"center"}},"About Arithmusic"),r.a.createElement(z.a,null,"Version: 1.0.0",r.a.createElement("br",null),"Last updated: June 20, 2019",r.a.createElement("br",null),r.a.createElement(oe.a,{href:"https://github.com/chrisdruta/arithmusic",target:"_blank"},"github.com/chrisdruta/arithmusic"),r.a.createElement("br",null),"GPL v3.0",r.a.createElement("br",null)),r.a.createElement(z.a,null,"Made with ",r.a.createElement("span",{role:"img",style:{fontSize:20},"aria-label":"heart"},"\u2764\ufe0f"),",",r.a.createElement("br",null),"Chris Druta"))),r.a.createElement("br",null),r.a.createElement("div",{className:"modalActions"},r.a.createElement(L.a,{variant:"contained",style:{marginRight:10},onClick:function(){return e.resetSettings()}},"Defaults"),r.a.createElement(L.a,{variant:"contained",onClick:function(){return e.toggleModal("settings")}},"Close"))))}var se=a(4199),ce=a(4200),ue=a(4201),me=a(4193),pe={fs:"Sampling frequency",volume:"Volume",multiplier:"Auto multiplier",expression:"Expression",length:"Length"};function ge(e){var t=r.a.useState(de),a=Object(O.a)(t,1)[0],n=ve(),o=[];return e.errors&&(e.errors.settings.forEach(function(t,a){o.push(r.a.createElement(se.a,{key:"s".concat(a)},r.a.createElement(ce.a,{primary:"".concat(pe[t]," in Settings")}))),a!==e.errors.settings.length-1?o.push(r.a.createElement(ue.a,{key:"ds".concat(a),variant:"middle"})):e.errors.editor.length&&o.push(r.a.createElement(ue.a,{key:"ds".concat(a),variant:"middle"}))}),e.errors.editor.forEach(function(t,a){o.push(r.a.createElement(se.a,{key:"e".concat(a)},r.a.createElement(ce.a,{primary:"".concat(pe[t.key]," for tab titled '").concat(t.title,"' in Timeline [row ").concat(t.row,", column ").concat(t.col,"]")}))),a!==e.errors.editor.length-1&&o.push(r.a.createElement(ue.a,{key:"de".concat(a),variant:"middle"}))})),r.a.createElement(Y.a,{open:e.open},r.a.createElement("div",{style:a,className:n.paper},r.a.createElement(z.a,{variant:"h5"},"Composition Errors"),r.a.createElement("br",null),r.a.createElement(z.a,{variant:"subtitle1"},"Please fix the following errors and try again"),r.a.createElement(me.a,{style:{width:"80%"}}," ",o," "),r.a.createElement("br",null),r.a.createElement("div",{className:"modalActions"},r.a.createElement(L.a,{variant:"contained",onClick:function(){return e.toggleModal("alert")}},"Close"))))}var he=a(4202);function de(){return{top:"".concat(50,"%"),left:"".concat(50,"%"),transform:"translate(-".concat(50,"%, -").concat(50,"%)")}}var ve=Object(he.a)(function(e){return{paper:{position:"absolute",width:600,backgroundColor:e.palette.background.paper,boxShadow:e.shadows[5],padding:e.spacing(4),outline:"none",display:"flex",flexDirection:"column",justifyContent:"space-evenly"},textField:{}}}),fe={selectedSegment:{row:0,col:0},compositionErrors:null,settings:{fs:{value:44100,error:""},volume:{value:10,error:""},multiplier:{value:1,error:""},graphRange:{value:4e3,error:""},aliasing:!1},showingModals:{load:!1,save:!1,settings:!1,alert:!1},timelines:[{options:{title:"C2 Steps",wave:"sine",mute:!1},segments:[{id:"t0",title:{value:"C2",error:""},expression:{value:"65.41",error:""},length:{value:500,error:""},volume:{value:100,error:""}},{id:"t1",title:{value:"D2",error:""},expression:{value:"73.42",error:""},length:{value:500,error:""},volume:{value:100,error:""}},{id:"t2",title:{value:"E2",error:""},expression:{value:"82.41",error:""},length:{value:500,error:""},volume:{value:100,error:""}},{id:"t3",title:{value:"F2",error:""},expression:{value:"87.31",error:""},length:{value:500,error:""},volume:{value:100,error:""}},{id:"t4",title:{value:"G2",error:""},expression:{value:"98",error:""},length:{value:500,error:""},volume:{value:100,error:""}},{id:"t5",title:{value:"A3",error:""},expression:{value:"110",error:""},length:{value:500,error:""},volume:{value:100,error:""}},{id:"t6",title:{value:"B2",error:""},expression:{value:"123.47",error:""},length:{value:500,error:""},volume:{value:100,error:""}},{id:"t7",title:{value:"C3",error:""},expression:{value:"130.81",error:""},length:{value:500,error:""},volume:{value:100,error:""}}]},{options:{title:"C2 Linear",wave:"sine",mute:!1},segments:[{id:"t8",title:{value:"Delay",error:""},expression:{value:"0",error:""},length:{value:4e3,error:""},volume:{value:100,error:""}},{id:"t9",title:{value:"Linear Eqn",error:""},expression:{value:"130.81 + x * (65.41 - 130.81) / 4",error:""},length:{value:4e3,error:""},volume:{value:100,error:""}}]}]},be=function(e){function t(e){var a;Object(u.a)(this,t),(a=Object(p.a)(this,Object(g.a)(t).call(this,e))).handlePlay=function(){if(a.getCompositionErrors())a.toggleModal("alert");else{var e=a.exportCompositionJson(),t=JSON.stringify({fs:a.state.settings.fs.value,volume:a.state.settings.volume.value,multiplier:a.state.settings.multiplier.value,aliasing:a.state.settings.aliasing}),n=a.wasm.synthesize_composition(e,t),r=a.audioContext.createBuffer(1,n.length,a.state.settings.fs.value);r.copyToChannel(n,0);var o=a.audioContext.createBufferSource();o.buffer=r,a.audioSources.push(o),o.connect(a.audioContext.destination),o.start(0)}},a.handleStop=function(){a.audioSources.forEach(function(e){return e.stop(0)})},a.handleAnimateGraph=function(){a.setState({revision:a.state.revision+1})},a.state=fe,a.state.revision=0,a.settingsChange=function(e,t){var a,n=this,r=Object(C.a)({},this.state.settings);"aliasing"!==e&&(a=parseInt(t),r[e].value=t),"volume"===e?a>=0?(r.volume.value=a,r.volume.error=""):isNaN(a)?r.volume.error="Not a number":r.volume.error="Can't be negative":"multiplier"===e?isNaN(a)?r.multiplier.error="Not a number":(r.multiplier.value=a,r.multiplier.error=""):"graphRange"===e?isNaN(a)?r.graphRange.error="Not a number":a<0?r.graphRange.error="Can't be negative":(r.graphRange.value=a,r.graphRange.error=""):"fs"===e?isNaN(a)?r.fs.error="Not a number":a<3e3?r.fs.error="Must be at least 3000":a>96e3?r.fs.error="Must be less than 96000":(r.fs.value=a,r.fs.error=""):"aliasing"===e&&(r.aliasing=!r.aliasing),this.setState({settings:r},function(){return n.getCompositionErrors()})}.bind(Object(h.a)(a)),a.trackDataChange=function(e,t,a,n,r){var o=this;if(e[a].segments[t][n].value=r,"title"===n)r.length>0?e[a].segments[t].title.error="":e[a].segments[t].title.error="Too short";else if("expression"===n){try{Object(w.b)(r).evaluate({x:1}),e[a].segments[t].expression.error=""}catch(s){e[a].segments[t].expression.error=s.message}0===r.length&&(e[a].segments[t].expression.error="Undefined")}else if("length"===n){var i=parseInt(r);i>=0?(e[a].segments[t].length.value=i,e[a].segments[t].length.error=""):isNaN(i)?e[a].segments[t].length.error="Not a number":e[a].segments[t].length.error="Can't be negative"}else if("volume"===n){var l=parseInt(r);l>=0?(e[a].segments[t].volume.value=l,e[a].segments[t].volume.error=""):isNaN(l)?e[a].segments[t].volume.error="Not a number":e[a].segments[t].volume.error="Can't be negative"}this.setState({timelines:e},function(){return o.getCompositionErrors()})}.bind(Object(h.a)(a)),a.toggleModal=function(e){var t=Object(C.a)({},this.state.showingModals);"save"===e&&this.state.compositionErrors?t.alert=!0:t[e]=!t[e],this.setState({showingModals:t})}.bind(Object(h.a)(a)),a.segmentSelection=function(e,t){this.setState({selectedSegment:{row:e,col:t}})}.bind(Object(h.a)(a)),a.segmentRearrange=function(e,t,a,n){var r=Object(C.a)({},this.state),o=r.selectedSegment,i=r.timelines;i[e].segments=n,this.setState({timelines:i}),t===o.col&&e===o.row&&(o.col=a,this.setState({selectedSegment:o}))}.bind(Object(h.a)(a)),a.addSegment=function(e){var t=Object(x.a)(this.state.timelines);t[e].segments=[].concat(Object(x.a)(t[e].segments),[{id:"t".concat(++this.idCount),title:{value:"New Tab",error:""},expression:{value:"440 + 100 * x",error:""},length:{value:500,error:""},volume:{value:100,error:""}}]),this.setState({timelines:t})}.bind(Object(h.a)(a)),a.deleteSegment=function(){var e=Object(C.a)({},this.state),t=e.selectedSegment,a=e.timelines;a[t.row].segments.splice(t.col,1),0===t.col?t.row>0&&(t.row--,t.col=a[t.row].segments.length-1):t.col--,this.setState({selectedSegment:t,timelines:a})}.bind(Object(h.a)(a)),a.trackOptionChange=function(e,t,a){var n=this.state.timelines;"title"===t?n[e].options.title=a:"wave"===t?n[e].options.wave=null===a?"sine":a:"mute"===t&&(n[e].options.mute=!n[e].options.mute),this.setState({timelines:n})}.bind(Object(h.a)(a)),a.addTrack=function(){var e=Object(x.a)(this.state.timelines);e.push({options:{title:"Untitled Track",wave:"sine",mute:!1},segments:[]}),this.setState({timelines:e})}.bind(Object(h.a)(a)),a.deleteTrack=function(e){var t=Object(C.a)({},this.state),a=t.selectedSegment,n=t.timelines;n.splice(e,1),a.row===e&&(a.row--,a.col=0),this.setState({selectedSegment:a,timelines:n})}.bind(Object(h.a)(a)),a.getCompositionErrors=function(){for(var e=[],t=0,a=Object.entries(this.state.settings);t<a.length;t++){var n=a[t],r=Object(O.a)(n,2),o=r[0];r[1].error&&"graphRange"!==o&&e.push(o)}var i=[];return this.state.timelines.forEach(function(e,t){e.segments.forEach(function(e,a){for(var n=0,r=Object.entries(e);n<r.length;n++){var o=r[n],l=Object(O.a)(o,2),s=l[0];l[1].error&&i.push({key:s,title:e.title.value,row:t+1,col:a+1})}})}),e.length||i.length?(this.setState({compositionErrors:{settings:e,editor:i}}),!0):(this.setState({compositionErrors:null}),!1)}.bind(Object(h.a)(a)),a.exportCompositionJson=function(){var e=this.state.timelines,t=[];return e.forEach(function(e){var a=[];e.segments.forEach(function(e){var t="";try{(t=Object(w.a)(e.expression.value)).traverse(function(e){if("OperatorNode"===e.type&&"*"===e.op&&e.implicit)return e.implicit=!e.implicit,e})}catch(n){}a.push({title:e.title.value,expression:t.toString(),length:e.length.value,volume:e.volume.value})}),t.push({options:e.options,segments:a})}),JSON.stringify(t)}.bind(Object(h.a)(a)),a.loadCompositionJson=function(e){var t=JSON.parse(e);if(!Array.isArray(t))return"Unexpected format";var a=0;try{for(var n in t)for(var r in t[n].segments){var o=Object(C.a)({},t[n].segments[r]),i="t".concat(a);t[n].segments[r]={title:{},expression:{},length:{},volume:{}},t[n].segments[r].id=i,this.trackDataChange(t,r,n,"title",o.title),this.trackDataChange(t,r,n,"expression",o.expression),this.trackDataChange(t,r,n,"length",o.length),this.trackDataChange(t,r,n,"volume",o.volume),a++}}catch(l){return void alert(l.message)}this.toggleModal("load"),this.setState({selectedSegment:{row:0,col:0}})}.bind(Object(h.a)(a)),a.resetSettings=function(){var e=this;this.setState({settings:{fs:{value:44100,error:""},volume:{value:10,error:""},multiplier:{value:1,error:""},graphRange:{value:4e3,error:""},aliasing:!1}},function(){return e.getCompositionErrors()})}.bind(Object(h.a)(a));var n=0,r=!0,o=!1,i=void 0;try{for(var l,s=a.state.timelines[Symbol.iterator]();!(r=(l=s.next()).done);r=!0){n+=l.value.segments.length}}catch(c){o=!0,i=c}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return a.idCount=n,a.audioContext=new(window.AudioContext||window.webkitAudioContext),a.audioSources=[],a}return Object(d.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=Object(c.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.e(3).then(a.bind(null,4213));case 2:this.wasm=e.sent;case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state.timelines;return r.a.createElement("div",{className:"App"},r.a.createElement(v.a,{position:"static"},r.a.createElement(f.a,{className:"AppBar"},r.a.createElement("span",{className:"title"},"Arithmusic"),r.a.createElement("div",{style:{flexGrow:1}}),r.a.createElement(b.a,{color:"inherit",onClick:this.handlePlay},r.a.createElement(E.g,null)),r.a.createElement(b.a,{color:"inherit",onClick:this.handleStop},r.a.createElement(E.i,null)),r.a.createElement(b.a,{color:"inherit",onClick:function(){return e.toggleModal("settings")}},r.a.createElement(E.k,null)))),r.a.createElement("div",{className:"AppContainer"},r.a.createElement(D,{revision:this.state.revision,multiplier:this.state.settings.multiplier.value,upperRange:this.state.settings.graphRange.value,data:this.state.timelines[this.state.selectedSegment.row]?this.state.timelines[this.state.selectedSegment.row].segments:null}),r.a.createElement(X,{animateGraph:this.handleAnimateGraph,timelines:t,selectedSegment:this.state.selectedSegment,onSegmentSelection:this.segmentSelection,onSegmentRearrange:this.segmentRearrange,onAddTrack:this.addTrack,onDeleteTrack:this.deleteTrack,onTrackOptionChange:this.trackOptionChange,onTrackDataChange:this.trackDataChange,onAddSegment:this.addSegment,onDeleteSegment:this.deleteSegment,toggleModal:this.toggleModal}),r.a.createElement(ae,{open:this.state.showingModals.load,toggleModal:this.toggleModal,onLoadJson:this.loadCompositionJson}),r.a.createElement(ee,{open:this.state.showingModals.save,toggleModal:this.toggleModal,currentComposition:this.exportCompositionJson()}),r.a.createElement(le,{open:this.state.showingModals.settings,settings:this.state.settings,toggleModal:this.toggleModal,onChange:this.settingsChange,resetSettings:this.resetSettings}),r.a.createElement(ge,{open:this.state.showingModals.alert,errors:this.state.compositionErrors,toggleModal:this.toggleModal})))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(be,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[3954,1,2]]]);
//# sourceMappingURL=main.159cc30a.chunk.js.map